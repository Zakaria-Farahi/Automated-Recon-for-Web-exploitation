#!/bin/bash

# Check if the script is run as root
if [ "$(id -u)" != "0" ]; then
  echo "This script must be run as root."
  exit 1
fi

# Check if the python3-venv package is installed
if ! dpkg -s python3-venv &>/dev/null; then
  echo "python3-venv package is not installed, installing it now."
  sudo apt update
  sudo apt install -y python3-venv
  if [ $? -ne 0 ]; then
    echo "Failed to install python3-venv. Please install python3-venv manually."
    exit 1
  fi
  echo "python3-venv installed successfully."
fi

# Check if Sublist3r is already installed
if ! command -v sublist3r &>/dev/null; then
  echo "Sublist3r is not installed."

  read -p "Do you want to install Sublist3r? (y / n): " accepted

  if [[ "$accepted" == "y" ]]; then
    echo "Installing Sublist3r..."
    # Install Sublist3r
    git clone https://github.com/aboul3la/Sublist3r.git >/dev/null
    sudo mv Sublist3r/ /opt/
    cd /opt/Sublist3r/
    python3 -m venv venv
    source venv/bin/activate
    # Install the requirements
    pip install -r requirements.txt
    # Create a script for easier execution
    echo "#!/bin/bash" >sublist3r
    echo "source /opt/Sublist3r/venv/bin/activate" >>sublist3r
    echo "python3 /opt/Sublist3r/sublist3r.py \"\$@\"" >>sublist3r
    chmod +x sublist3r
    sudo mv sublist3r /usr/local/bin/
    echo "Sublist3r installed successfully."
  else
    echo "Installation cancelled."
  fi
else
  echo "Sublist3r is already installed."
fi
