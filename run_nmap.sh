#!/bin/bash

# Function to display usage information
usage() {
  echo "Usage: $0 <domain_list_file>"
  echo "       $0 -h  Display this help message"
  exit 1
}

# Check if help is requested
if [ "$1" = "-h" ]; then
  usage
fi

# Check if the correct number of arguments is given
if [ $# -ne 1 ]; then
  usage
fi

# Assign the file name to a variable
input_file=$1

# Check if the file exists
if [ ! -f "$input_file" ]; then
  echo "File not found: $input_file"
  exit 1
fi

# Check if nmap is installed
if ! command -v nmap &>/dev/null; then
  echo "nmap could not be found. Please install it first."
  exit 1
fi

# Directory to save nmap output files, using the current date and time
current_date=$(date +"%Y-%m-%d_%H-%M-%S")
output_directory="./port_Scan/nmap/$current_date"

# Create output directory if it doesn't exist
mkdir -p "$output_directory"

# Loop through each line in the file
while IFS= read -r domain; do
  if [[ -n "$domain" ]]; then # Ensure the line is not empty
    echo "Running nmap for $domain..."
    # Customize your nmap scan options here; for example, -sV attempts to determine service/version info
    nmap -sV "$domain" -oN "$output_directory/${domain//[^a-zA-Z0-9]/_}.txt" >/dev/null
  fi
done <"$input_file"

echo "nmap scans completed for all domains listed in $input_file."
